// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATABASE.IFA - Simple File-Based Database
// Demonstrates file I/O, JSON persistence, and CRUD operations
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Run: ifa run examples/05_advanced/database.ifa
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã¬bÃ  Irosu;    // Output
Ã¬bÃ  Odi;      // File I/O
Ã¬bÃ  Ogunda;   // Arrays
Ã¬bÃ  Ofun;     // Objects
Ã¬bÃ  Ika;      // Strings
Ã¬bÃ  Owonrin;  // Random (for IDs)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATABASE CLASS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

odÃ¹ Database {
    ayanmá» filepath = "";
    ayanmá» data = [];
    
    ese dÃ¡(path) {
        filepath = path;
        load();
    }
    
    ese load() {
        ti Odi.wa(filepath) {
            ayanmá» content = Odi.ka(filepath);
            data = Ofun.from_json(content);
            Irosu.fo("ğŸ“‚ Loaded " + Ogunda.gigun(data) + " records from " + filepath);
        } bibáº¹ká» {
            data = [];
            Irosu.fo("ğŸ“‚ Created new database: " + filepath);
        }
    }
    
    ese save() {
        ayanmá» content = Ofun.to_json(data);
        Odi.ko(filepath, content);
        Irosu.fo("ğŸ’¾ Saved " + Ogunda.gigun(data) + " records");
    }
    
    ese insert(record) {
        // Generate unique ID
        ayanmá» id = Owonrin.da(10000, 99999);
        record = Ofun.fi(record, "id", id);
        
        data = Ogunda.fi(data, record);
        Irosu.fo("âœ… Inserted record with ID: " + id);
        padÃ  id;
    }
    
    ese find_by_id(id) {
        fun record ninu data {
            ti record.id == id {
                padÃ  record;
            }
        }
        padÃ  iro;
    }
    
    ese find_all() {
        padÃ  data;
    }
    
    ese find_where(field, value) {
        ayanmá» results = [];
        
        fun record ninu data {
            ti Ofun.gba(record, field) == value {
                results = Ogunda.fi(results, record);
            }
        }
        
        padÃ  results;
    }
    
    ese update(id, updates) {
        ayanmá» i = 0;
        
        fun record ninu data {
            ti record.id == id {
                // Merge updates into record
                fun key ninu Ofun.keys(updates) {
                    ayanmá» val = Ofun.gba(updates, key);
                    data[i] = Ofun.fi(data[i], key, val);
                }
                Irosu.fo("âœ… Updated record ID: " + id);
                padÃ  otito;
            }
            i = i + 1;
        }
        
        Irosu.fo("âŒ Record not found: " + id);
        padÃ  iro;
    }
    
    ese delete(id) {
        ayanmá» new_data = [];
        ayanmá» found = iro;
        
        fun record ninu data {
            ti record.id != id {
                new_data = Ogunda.fi(new_data, record);
            } bibáº¹ká» {
                found = otito;
            }
        }
        
        ti found {
            data = new_data;
            Irosu.fo("ğŸ—‘ï¸  Deleted record ID: " + id);
        } bibáº¹ká» {
            Irosu.fo("âŒ Record not found: " + id);
        }
        
        padÃ  found;
    }
    
    ese count() {
        padÃ  Ogunda.gigun(data);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN PROGRAM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Irosu.fo("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
Irosu.fo("â•‘        IfÃ¡-Lang File Database Demo                       â•‘");
Irosu.fo("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

// Create/open database
ayanmá» db = Database.dÃ¡("users.json");

// Insert some records
Irosu.fo("\nğŸ“ Inserting records...");

ayanmá» user1 = Ofun.da();
user1 = Ofun.fi(user1, "name", "AdÃ© OlÃºwa");
user1 = Ofun.fi(user1, "email", "ade@example.com");
user1 = Ofun.fi(user1, "age", 28);
ayanmá» id1 = db.insert(user1);

ayanmá» user2 = Ofun.da();
user2 = Ofun.fi(user2, "name", "Tayo AdÃ©bÃ¡yá»Ì€");
user2 = Ofun.fi(user2, "email", "tayo@example.com");
user2 = Ofun.fi(user2, "age", 34);
ayanmá» id2 = db.insert(user2);

ayanmá» user3 = Ofun.da();
user3 = Ofun.fi(user3, "name", "Káº¹Ìmi á»ŒlÃ¡dÃ©lÃ©");
user3 = Ofun.fi(user3, "email", "kemi@example.com");
user3 = Ofun.fi(user3, "age", 28);
db.insert(user3);

// Query records
Irosu.fo("\nğŸ” Querying records...");

ayanmá» all_users = db.find_all();
Irosu.fo("Total records: " + db.count());

// Find by ID
ayanmá» found = db.find_by_id(id1);
ti found {
    Irosu.fo("Found user: " + found.name);
}

// Find by field
ayanmá» age_28 = db.find_where("age", 28);
Irosu.fo("Users age 28: " + Ogunda.gigun(age_28));

// Update a record
Irosu.fo("\nâœï¸ Updating record...");
ayanmá» updates = Ofun.da();
updates = Ofun.fi(updates, "age", 29);
db.update(id1, updates);

// Delete a record
Irosu.fo("\nğŸ—‘ï¸ Deleting record...");
db.delete(id2);

// Save to disk
Irosu.fo("\nğŸ’¾ Saving database...");
db.save();

// Print final state
Irosu.fo("\nğŸ“‹ Final database contents:");
ayanmá» final = db.find_all();
fun user ninu final {
    Irosu.fo("  - " + user.name + " (age: " + user.age + ")");
}

Irosu.fo("\nğŸ‰ Database demo complete!");
Ã á¹£áº¹;
