<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 14: Resource Management - Tour of Ifá</title>
    <style>
        :root {
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --accent: #e94560;
            --gold: #ffd700;
            --text: #eaeaea;
            --text-dim: #a0a0a0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.7;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .lesson-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent);
        }

        .lesson-num {
            background: var(--accent);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        h1 {
            color: var(--gold);
            font-size: 2rem;
        }

        h2 {
            color: var(--gold);
            margin: 2rem 0 1rem;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 0.5rem;
        }

        h3 {
            color: var(--accent);
            margin: 1.5rem 0 0.5rem;
        }

        p {
            margin: 1rem 0;
        }

        pre {
            background: #0d1321;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--gold);
        }

        .concept {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 3px solid var(--accent);
        }

        .concept h4 {
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--accent);
        }

        .nav-btn {
            background: var(--bg-card);
            color: var(--gold);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            border: 1px solid var(--accent);
        }

        .nav-btn:hover {
            background: var(--accent);
            color: white;
        }

        .nav-btn.primary {
            background: var(--accent);
            color: white;
        }

        a {
            color: var(--gold);
        }
    </style>
</head>


    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
        <div class="breadcrumbs-container">
            <ul class="breadcrumb-list">
                <!-- Breadcrumbs will be generated by JavaScript -->
            </ul>
        </div>
    </div>
    <div class="container">
        <div class="lesson-header">
            <div class="lesson-num">14</div>
            <div>
                <h1>Resource Management</h1>
                <p style="color: var(--text-dim); margin: 0;">RAII cleanup with ?b? (ebo)</p>
            </div>
        </div>

        <h2>What is ?b??</h2>
        <p><strong>?b?</strong> (Yoruba: "sacrifice/offering") ensures cleanup code runs automatically when resources go
            out of scope. It's similar to:</p>
        <ul style="margin-left: 2rem; color: var(--text-dim);">
            <li>Go's <code>defer</code></li>
            <li>Python's <code>with</code></li>
            <li>Rust's RAII / <code>Drop</code></li>
        </ul>

        <h2>Basic ?b? Statement</h2>
        <pre><code>// Declare resource with automatic cleanup
ebo "database";

// Open connection
ayanmo conn = db.connect();

// Do work...
conn.query("SELECT * FROM users");

// When scope ends, cleanup runs automatically
// Connection is closed, resources freed</code></pre>

        <h2>Ebo Guard Pattern</h2>
        <pre><code>// Create RAII guard with cleanup function
ayanmo guard = Ebo.new("tempfile", || {
    Odi.delete("temp.txt");
    Irosu.fo("Temp file deleted");
});

// Create temp file
Odi.write("temp.txt", "temporary data");

// Do work with temp file...

// When guard goes out of scope:
// ? Cleanup runs automatically
// ? "Temp file deleted" is printed</code></pre>

        <h2>Dismissing Cleanup</h2>
        <pre><code>ayanmo guard = Ebo.new("lock", || release_lock());

// Decide to keep the lock
guard.dismiss();  // Cleanup will NOT run

// Lock remains acquired</code></pre>

        <h2>Early Cleanup</h2>
        <pre><code>ayanmo guard = Ebo.new("cache", || cache.flush());

// Force cleanup now instead of waiting
guard.sacrifice();  // Runs immediately

// After sacrifice, guard is dismissed</code></pre>

        <h2>EboScope: Scoped Resources</h2>
        <pre><code>// Wrap a value with automatic cleanup
ayanmo scoped = EboScope.new(
    Odi.open("data.txt"),
    |file| file.sync()  // Cleanup function
);

// Use the file
scoped.write("Hello");
scoped.write("World");

// When scoped drops:
// ? file.sync() called automatically
// ? File is properly saved</code></pre>

        <h2>Practical Examples</h2>

        <div class="concept">
            <h4>?? Lock Management</h4>
            <pre style="margin: 0;"><code>ise with_lock(lock, work) {
    lock.acquire();
    ebo "lock";  // Auto-release
    
    work();  // Do protected work
    
    // Lock released when scope ends
}</code></pre>
        </div>

        <div class="concept">
            <h4>?? Temporary Files</h4>
            <pre style="margin: 0;"><code>ise with_temp_file(work) {
    ayanmo path = "/tmp/" + Irete.uuid();
    
    ayanmo guard = Ebo.new("temp", || {
        Odi.delete(path);
    });
    
    Odi.write(path, "");
    work(path);
    
    // File deleted automatically
}</code></pre>
        </div>

        <div class="concept">
            <h4>?? Database Connections</h4>
            <pre style="margin: 0;"><code>ise with_connection(db_url, work) {
    ayanmo conn = DB.connect(db_url);
    
    ayanmo guard = Ebo.new("db", || {
        conn.close();
    });
    
    work(conn);
    
    // Connection closed on return
}</code></pre>
        </div>

        <h2>Why Use ?b??</h2>
        <ul style="margin-left: 2rem; color: var(--text-dim);">
            <li><strong>No leaks:</strong> Resources always cleaned up</li>
            <li><strong>Exception-safe:</strong> Cleanup runs even on errors</li>
            <li><strong>Clear intent:</strong> Cleanup logic next to creation</li>
            <li><strong>Zero-cost:</strong> No runtime overhead</li>
        </ul>

        <div class="nav-buttons">
            <a href="13-network.html" class="nav-btn">? Previous: Networking</a>
            <a href="15-reactivity.html" class="nav-btn primary">Next: Reactivity ?</a>
        </div>
    </div>
        <script src="../../../js/nav.js"></script>
    <script src="../../../js/common.js"></script>
</body>

</html>

