<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Tutorial - Ifá-Lang</title>
    <style>
        :root {
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --accent: #e94560;
            --gold: #ffd700;
            --text: #eaeaea;
            --text-dim: #a0a0a0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.7;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1 {
            color: var(--gold);
            font-size: 2.5rem;
        }

        h2 {
            color: var(--gold);
            margin: 2.5rem 0 1rem;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 0.5rem;
        }

        h3 {
            color: var(--accent);
            margin: 1.5rem 0 0.5rem;
        }

        p {
            margin: 1rem 0;
        }

        pre {
            background: #0d1321;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--gold);
        }

        a {
            color: var(--gold);
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-dim);
            border-top: 1px solid var(--accent);
            margin-top: 3rem;
        }
    </style>
</head>


    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
        <div class="breadcrumbs-container">
            <ul class="breadcrumb-list">
                <!-- Breadcrumbs will be generated by JavaScript -->
            </ul>
        </div>
    </div>
    <div class="container">
        <h1>? Performance Tutorial</h1>
        <p>Optimize your Ifá-Lang programs with CPU parallelism, GPU acceleration, and efficient data structures.</p>

        <h2>Profiling</h2>
        <p>Measure before optimizing:</p>
        <pre><code>ise benchmark(name, func) {
    ayanmo start = Iwori.now_ns();
    ayanmo result = func();
    ayanmo elapsed = (Iwori.now_ns() - start) / 1000000;
    Irosu.fo(name + ": " + elapsed + " ms");
    padap? result;
}

// Usage
benchmark("Process data", || {
    process_large_dataset(data);
});</code></pre>

        <h2>CPU Parallelism</h2>
        <p>Use the <code>CPU</code> infrastructure for parallel operations:</p>

        <h3>Parallel Map</h3>
        <pre><code>// Sequential (slow)
ayanmo results = [];
fun item ninu large_list {
    ayanmo results = Ogunda.push(results, expensive_operation(item));
}

// Parallel (fast)
ayanmo results = CPU.par_map(large_list, expensive_operation);</code></pre>

        <h3>Parallel Reduce</h3>
        <pre><code>// Sum 1 million numbers
ayanmo numbers = Obara.range(1, 1000001);

// Parallel sum
ayanmo total = CPU.par_reduce(numbers, 0, |x| x, |a, b| a + b);</code></pre>

        <h3>Thread Pool Configuration</h3>
        <pre><code>// Use all cores (default)
CPU.configure(CPU.num_threads());

// Or limit to specific count
CPU.configure(4);  // Use 4 threads</code></pre>

        <h2>GPU Acceleration</h2>
        <p>For heavy numerical work, use GPU compute:</p>
        <pre><code>// Initialize GPU
ayanmo gpu = GPU.new();

// Matrix multiplication on GPU
ayanmo a = create_matrix(1024, 1024);
ayanmo b = create_matrix(1024, 1024);

ayanmo buf_a = GPU.create_buffer(a);
ayanmo buf_b = GPU.create_buffer(b);

// Compute on GPU (massively parallel)
ayanmo buf_c = GPU.matmul(buf_a, buf_b, 1024, 1024, 1024);

// Read result back
ayanmo c = GPU.read_buffer(buf_c);</code></pre>

        <h3>GPU Memory Pooling</h3>
        <pre><code>// Create memory pool for repeated allocations
ayanmo pool = GPU.create_slab_pool();

fun i ninu Obara.range(0, 1000) {
    ayanmo buf = pool.alloc(4096);  // Fast allocation
    // ... use buffer ...
    pool.free(buf);  // Return to pool
}</code></pre>

        <h2>Efficient Data Structures</h2>

        <h3>List vs. Map Lookup</h3>
        <pre><code>// Slow: O(n) lookup
ayanmo users = [{"id": 1, "name": "Alice"}, ...];
ayanmo user = Ogunda.find(users, |u| u["id"] == 5);  // Scans entire list

// Fast: O(1) lookup
ayanmo user_map = {};
fun u ninu users {
    user_map[u["id"]] = u;
}
ayanmo user = user_map[5];  // Direct access</code></pre>

        <h3>Lazy Processing</h3>
        <pre><code>// Avoid: Creates intermediate lists
ayanmo result = Ogunda.map(data, transform);
ayanmo result = Ogunda.filter(result, is_valid);
ayanmo result = Ogunda.take(result, 10);

// Better: Single pass with early exit
ayanmo result = [];
fun item ninu data {
    ayanmo transformed = transform(item);
    ti (is_valid(transformed)) {
        ayanmo result = Ogunda.push(result, transformed);
        ti (Ogunda.len(result) >= 10) { da; }
    }
}</code></pre>

        <h2>Memory Optimization</h2>

        <h3>Resource Cleanup with ?b?</h3>
        <pre><code>ise process_file(path) {
    ?b? file = Odi.open(path);  // Automatically closed when scope ends
    
    ayanmo content = file.read();
    padap? process(content);
}  // File closed here, even if error occurs</code></pre>

        <h3>Check Memory Usage</h3>
        <pre><code>ise memory_aware_process(data) {
    ayanmo stats = Kernel.memory_stats();
    ayanmo available_mb = stats.available / 1024 / 1024;
    
    ti (available_mb < 100) {
        Irosu.kigbe("Low memory, using smaller batches");
        padap? process_in_batches(data, 100);
    }
    
    padap? process_all(data);
}</code></pre>

        <h2>Common Bottlenecks</h2>
        <ul style="margin-left: 1.5rem;">
            <li><strong>String concatenation in loops</strong> — Use list + join</li>
            <li><strong>Repeated list scans</strong> — Build a map for O(1) lookup</li>
            <li><strong>Synchronous I/O</strong> — Use parallel batch operations</li>
            <li><strong>Creating objects in hot loops</strong> — Pre-allocate when possible</li>
        </ul>

        <footer class="doc-footer">
            <p><a href="debugging.html">? Debugging</a> · <a href="../index.html">Tutorials Index</a></p>
            <p><a href="../index.html">Documentation Home</a></p>
        </footer>
    </div>
    <script src="../js/nav.js"></script>
    <script src="../js/common.js"></script>
</body>

</html>

