<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Infrastructure - Ifá-Lang</title>
    <style>
        :root {
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --accent: #e94560;
            --gold: #ffd700;
            --text: #eaeaea;
            --text-dim: #a0a0a0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.7;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1 {
            color: var(--gold);
            font-size: 2.5rem;
        }

        h2 {
            color: var(--gold);
            margin: 2.5rem 0 1rem;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 0.5rem;
        }

        h3 {
            color: var(--accent);
            margin: 1.5rem 0 0.5rem;
        }

        p {
            margin: 1rem 0;
        }

        pre {
            background: #0d1321;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--gold);
        }

        .api-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .api-card h4 {
            color: var(--gold);
            margin: 0 0 0.5rem;
            font-family: monospace;
        }

        a {
            color: var(--gold);
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-dim);
            border-top: 1px solid var(--accent);
            margin-top: 3rem;
        }
    </style>
</head>


    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
        <div class="breadcrumbs-container">
            <ul class="breadcrumb-list">
                <!-- Breadcrumbs will be generated by JavaScript -->
            </ul>
        </div>
    </div>
    <div class="container">
        <h1>?? GPU Infrastructure</h1>
        <p>Hardware acceleration via WGPU with production-grade memory pooling.</p>
        <p><strong>Source:</strong> <code>crates/ifa-std/src/infra/gpu.rs</code> (684 lines)</p>
        <p><strong>Feature Flag:</strong> <code>gpu</code></p>

        <h2>GpuContext</h2>
        <p>Global GPU context with pipeline caching.</p>

        <div class="api-card">
            <h4>GpuContext.new() ? Result&lt;Self, String&gt;</h4>
            <p>Initialize GPU (headless mode for compute).</p>
            <pre><code>ayanmo gpu = GPU.new();
ti (GPU.is_error(gpu)) {
    Irosu.kigbe("No GPU available, falling back to CPU");
}</code></pre>
        </div>

        <div class="api-card">
            <h4>GpuContext.new_blocking() ? Result&lt;Self, String&gt;</h4>
            <p>Blocking initialization for synchronous CLI usage.</p>
        </div>

        <h2>Compute Operations</h2>

        <div class="api-card">
            <h4>GpuContext.matmul(a, b, m, n, k) ? Buffer</h4>
            <p>Matrix multiplication: C = A * B. A is M×K, B is K×N, C is M×N.</p>
            <pre><code>// Upload matrices to GPU
ayanmo buf_a = GPU.create_buffer(matrix_a);
ayanmo buf_b = GPU.create_buffer(matrix_b);

// Compute on GPU
ayanmo buf_c = GPU.matmul(buf_a, buf_b, 1024, 1024, 1024);

// Download result
ayanmo result = GPU.read_buffer(buf_c);</code></pre>
        </div>

        <div class="api-card">
            <h4>GpuContext.relu(data, count)</h4>
            <p>Apply ReLU activation in-place.</p>
            <pre><code>GPU.relu(buffer, 1000000);  // ReLU on 1M floats</code></pre>
        </div>

        <div class="api-card">
            <h4>GpuContext.map_scale_bias(input, count, scale, bias) ? Buffer</h4>
            <p>Elementwise: output[i] = input[i] * scale + bias</p>
            <pre><code>// Normalize: (x - mean) / std
ayanmo normalized = GPU.map_scale_bias(data, count, 1/std, -mean/std);</code></pre>
        </div>

        <div class="api-card">
            <h4>GpuContext.vec_add(a, b, count) ? Buffer</h4>
            <p>Vector addition: c = a + b.</p>
        </div>

        <div class="api-card">
            <h4>GpuContext.sync()</h4>
            <p>Wait for all GPU operations to complete.</p>
        </div>

        <h2>Pipeline Management</h2>

        <div class="api-card">
            <h4>GpuContext.get_or_create_pipeline(name, shader, entry) ? Pipeline</h4>
            <p>Get or create a cached compute pipeline from WGSL source.</p>
            <pre><code>ayanmo pipeline = GPU.get_or_create_pipeline(
    "my_shader",
    "@compute @workgroup_size(256) fn main() { ... }",
    "main"
);</code></pre>
        </div>

        <h2>Memory Management</h2>

        <h3>MemoryPool</h3>
        <p>Simple bump allocator for frame-based allocation.</p>

        <div class="api-card">
            <h4>GpuContext.create_memory_pool(size) ? MemoryPool</h4>
            <p>Create a memory pool of given size.</p>
            <pre><code>ayanmo pool = GPU.create_memory_pool(64 * 1024 * 1024);  // 64MB</code></pre>
        </div>

        <div class="api-card">
            <h4>MemoryPool.allocate(size) ? Option&lt;PoolAllocation&gt;</h4>
            <p>Allocate from the pool.</p>
        </div>

        <div class="api-card">
            <h4>MemoryPool.reset()</h4>
            <p>Reset pool for next frame (fast, O(1)).</p>
        </div>

        <h3>SlabMemoryPool</h3>
        <p>Slab-based allocator for varied sizes.</p>

        <div class="api-card">
            <h4>GpuContext.create_slab_pool() ? SlabMemoryPool</h4>
            <p>Create a slab memory pool with power-of-2 size classes.</p>
            <pre><code>ayanmo slab = GPU.create_slab_pool();

// Allocate buffers of various sizes
ayanmo small = slab.alloc(256);
ayanmo medium = slab.alloc(4096);
ayanmo large = slab.alloc(1048576);

// Free when done
slab.free(small);
slab.free(medium);
slab.free(large);</code></pre>
        </div>

        <h2>GpuVec</h2>
        <p>Type-safe GPU buffer wrapper.</p>
        <pre><code>// Create typed GPU vector
ayanmo vec = GpuVec.new(buffer, 1000);
Irosu.fo("Elements: " + vec.len);</code></pre>

        <footer class="doc-footer">
            <p><a href="cpu.html">? CPU</a> · <a href="storage.html">Storage ?</a></p>
            <p><a href="../../index.html">Documentation Home</a></p>
        </footer>
    </div>
    <script src="../../js/nav.js"></script>
    <script src="../../js/common.js"></script>
</body>

</html>

